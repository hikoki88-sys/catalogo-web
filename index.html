<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cat√°logo Mayorista</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: Arial, sans-serif;
  background:#fff;
  margin:0;
  padding:20px;
}
h1{
  text-align:center;
}
input, select{
  width:100%;
  padding:10px;
  margin:10px 0;
}
#filters{
  text-align:center;
  margin-bottom:20px;
}
button{
  padding:8px 14px;
  margin:4px;
  border:none;
  background:#000;
  color:#fff;
  cursor:pointer;
}
button.active{
  background:#444;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  gap:20px;
}
.card{
  border:1px solid #ddd;
  padding:15px;
  border-radius:8px;
}
.card img{
  width:100%;
  height:200px;
  object-fit:contain;
}
.price{
  font-weight:bold;
  margin:5px 0;
}
</style>
</head>

<body>

<h1>Cat√°logo Mayorista</h1>
<p style="text-align:center">Selecciona tu modelo y compra por WhatsApp</p>

<input id="search" placeholder="Buscar modelo...">

<div id="filters">
  <button onclick="setQuality('')" class="active">Todos</button>
  <button onclick="setQuality('PK')">PK</button>
  <button onclick="setQuality('LJR')">LJR</button>
</div>

<div id="products" class="grid"></div>

<script>
const CSV_PATH = "data/catalogo.csv";
const WSP_NUMBER = "51994275618";

let productos = [];
let filtroCalidad = "";

fetch(CSV_PATH)
  .then(r => r.text())
  .then(text => {
    productos = parseCSV(text);
    render();
  });

function parseCSV(text){
  const lines = text.trim().split("\n");
  const headers = lines.shift().split(";");

  return lines.map(line=>{
    const values = line.split(";");
    const obj = {};
    headers.forEach((h,i)=>{
      if(h==="tallas"){
        obj[h] = values[i] ? values[i].split(",").map(t=>t.trim()) : [];
      }else{
        obj[h] = values[i] ? values[i].trim() : "";
      }
    });
    return obj;
  });
}

function setQuality(q){
  filtroCalidad = q;
  document.querySelectorAll("#filters button").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
  render();
}

document.getElementById("search").addEventListener("input",render);

function render(){
  const cont = document.getElementById("products");
  cont.innerHTML = "";

  const search = document.getElementById("search").value.toLowerCase();

  productos
    .filter(p => (!filtroCalidad || p.calidad === filtroCalidad))
    .filter(p => p.nombre.toLowerCase().includes(search))
    .forEach((p,i)=>{
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <img src="img/${p.imagen}" alt="${p.nombre}">
        <h3>${p.nombre}</h3>
        <div class="price">S/ ${p.precio}</div>
        <div>Calidad: ${p.calidad}</div>

        <label>Talla:</label>
        <select id="talla-${i}">
          <option value="">Seleccionar talla</option>
          ${p.tallas.map(t=>`<option value="${t}">${t}</option>`).join("")}
        </select>

        <button onclick="comprar(
          '${p.nombre}',
          '${p.calidad}',
          '${p.precio}',
          'talla-${i}'
        )">Comprar por WhatsApp</button>
      `;
      cont.appendChild(div);
    });
}

function comprar(nombre, calidad, precio, tallaId){
  const talla = document.getElementById(tallaId).value;
  if(!talla){
    alert("Selecciona una talla");
    return;
  }

  const msg = `
Hola, quiero comprar:

üëü Modelo: ${nombre}
‚≠ê Calidad: ${calidad}
üìè Talla: ${talla}
üí∞ Precio: S/ ${precio}
  `;

  window.open(
    `https://wa.me/${WSP_NUMBER}?text=${encodeURIComponent(msg)}`,
    "_blank"
  );
}
</script>

</body>
</html>
