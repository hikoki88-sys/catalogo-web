<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Catálogo Mayorista</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body{
  font-family: Arial, sans-serif;
  background:#fff;
  margin:0;
  padding:20px;
}
h1{text-align:center;}
.filters{text-align:center;margin:15px 0;}
.filters button{
  margin:5px;
  padding:8px 14px;
  cursor:pointer;
}
#search{
  width:100%;
  padding:10px;
  margin:15px 0;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  gap:15px;
}
.card{
  border:1px solid #ddd;
  padding:12px;
}
.card img{
  width:100%;
  height:180px;
  object-fit:contain;
  background:#f5f5f5;
}
.card h3{margin:8px 0;}
.price{font-weight:bold;}
select,button{
  width:100%;
  padding:8px;
  margin-top:6px;
}
</style>
</head>

<body>

<h1>Catálogo Mayorista</h1>

<input id="search" placeholder="Buscar modelo..." />

<div class="filters">
  <button onclick="setQuality('')">Todos</button>
  <button onclick="setQuality('PK')">PK</button>
  <button onclick="setQuality('LJR')">LJR</button>
</div>

<div class="grid" id="grid"></div>

<script>
const CSV_PATH = "./data/catalogo.csv";
const WHATSAPP = "51994275618";

let products = [];
let qualityFilter = "";
let searchText = "";

fetch(CSV_PATH)
  .then(r => r.text())
  .then(text => {
    products = parseCSV(text);
    render();
  })
  .catch(err => {
    console.error("Error cargando CSV", err);
  });

function parseCSV(text){
  const lines = text.trim().split("\n");
  const headers = lines.shift().split(";");
  return lines.map(line=>{
    const cols = line.split(";");
    const obj = {};
    headers.forEach((h,i)=> obj[h.trim()] = (cols[i]||"").trim());
    obj.tallas = obj.tallas ? obj.tallas.split(",") : [];
    return obj;
  });
}

function setQuality(q){
  qualityFilter = q;
  render();
}

document.getElementById("search").addEventListener("input",e=>{
  searchText = e.target.value.toLowerCase();
  render();
});

function render(){
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  products
    .filter(p => !qualityFilter || p.calidad === qualityFilter)
    .filter(p => p.nombre.toLowerCase().includes(searchText))
    .forEach(p=>{
      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <img src="img/${p.imagen}" onerror="this.src='';this.style.display='none'">
        <h3>${p.nombre}</h3>
        <div>Calidad: ${p.calidad}</div>
        <div class="price">S/ ${p.precio}</div>

        <select id="talla-${p.nombre}">
          <option value="">Selecciona talla</option>
          ${p.tallas.map(t=>`<option value="${t}">${t}</option>`).join("")}
        </select>

        <button onclick="buy('${p.nombre}','${p.precio}','${p.calidad}','${p.imagen}')">
          Comprar por WhatsApp
        </button>
      `;
      grid.appendChild(card);
    });
}

function buy(nombre,precio,calidad,imagen){
  const select = document.querySelector(`#talla-${CSS.escape(nombre)}`);
  const talla = select.value;
  if(!talla){
    alert("Selecciona una talla");
    return;
  }

  const msg = `Hola, quiero comprar:
Modelo: ${nombre}
Calidad: ${calidad}
Precio: S/ ${precio}
Talla: ${talla}`;

  const url = `https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`;
  window.open(url,"_blank");
}
</script>

</body>
</html>
