<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catálogo Mayorista</title>

<style>
body{
  font-family:Arial, sans-serif;
  background:#fff;
  margin:0;
  padding:20px;
}
h1{text-align:center;margin-bottom:10px}
.filters{
  text-align:center;
  margin-bottom:20px;
}
button{
  padding:8px 14px;
  margin:5px;
  border:1px solid #000;
  background:#fff;
  cursor:pointer;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:15px;
}
.card{
  border:1px solid #ddd;
  padding:12px;
}
.card img{
  width:100%;
  height:160px;
  object-fit:cover;
  background:#f2f2f2;
}
select{
  width:100%;
  padding:6px;
  margin-top:6px;
}
.buy{
  width:100%;
  margin-top:8px;
  padding:10px;
  background:#25D366;
  color:#fff;
  border:none;
}
</style>
</head>

<body>

<h1>Catálogo Mayorista</h1>

<div class="filters">
  <button onclick="setQuality('ALL')">Todos</button>
  <button onclick="setQuality('PK')">PK</button>
  <button onclick="setQuality('LJR')">LJR</button>
</div>

<div class="grid" id="grid"></div>

<script>
const WHATSAPP = "51994275618";
let productos = [];
let filtro = "ALL";

fetch("data/catalogo.csv")
  .then(r => r.text())
  .then(text => {
    productos = parseCSV(text);
    render();
  });

function parseCSV(text){
  const lines = text.trim().split("\n");
  const headers = lines.shift().split(";");

  return lines.map(line=>{
    const data = line.split(";");
    let obj = {};
    headers.forEach((h,i)=>{
      if(h === "tallas"){
        obj.tallas = data[i] ? data[i].split(",").map(t=>t.trim()) : [];
      }else{
        obj[h] = data[i] ? data[i].trim() : "";
      }
    });
    return obj;
  });
}

function setQuality(q){
  filtro = q;
  render();
}

function render(){
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  productos
    .filter(p => filtro==="ALL" || p.calidad===filtro)
    .forEach((p,i)=>{
      const div = document.createElement("div");
      div.className = "card";

      div.innerHTML = `
        ${p.imagen ? `<img src="img/${p.imagen}">` : `<div style="height:160px;background:#eee"></div>`}
        <strong>${p.nombre}</strong><br>
        Calidad: ${p.calidad}<br>
        Precio: S/ ${p.precio}

        <select id="talla-${i}">
          <option value="">Selecciona talla</option>
          ${p.tallas.map(t=>`<option value="${t}">${t}</option>`).join("")}
        </select>

        <button class="buy" onclick="comprar('${p.nombre}','${p.calidad}','${p.precio}',${i})">
          Comprar por WhatsApp
        </button>
      `;
      grid.appendChild(div);
    });
}

function comprar(nombre, calidad, precio, i){
  const talla = document.getElementById(`talla-${i}`).value;
  if(!talla){
    alert("Selecciona una talla");
    return;
  }

  const msg = `Hola, quiero comprar:
Modelo: ${nombre}
Calidad: ${calidad}
Talla: ${talla}
Precio: S/ ${precio}`;

  window.open(`https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`);
}
</script>

</body>
</html>
