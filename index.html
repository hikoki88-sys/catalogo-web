<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Catálogo Mayorista</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial, sans-serif;
  background:#fff;
  margin:0;
  padding:20px;
}
h1{text-align:center}

.filters{
  display:flex;
  gap:10px;
  justify-content:center;
  margin-bottom:20px;
}

.filters button{
  padding:8px 16px;
  border:1px solid #000;
  background:#fff;
  cursor:pointer;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  gap:20px;
}

.card{
  border:1px solid #ddd;
  padding:10px;
}

.card img{
  width:100%;
  height:220px;
  object-fit:contain;
  background:#f5f5f5;
}

.card h3{margin:10px 0 5px}
.card p{margin:4px 0}

select, button.buy{
  width:100%;
  margin-top:8px;
  padding:8px;
}
</style>
</head>

<body>

<h1>Catálogo Mayorista</h1>

<div class="filters">
  <button onclick="setQuality('ALL')">Todos</button>
  <button onclick="setQuality('PK')">PK</button>
  <button onclick="setQuality('LJR')">LJR</button>
</div>

<div id="catalogo" class="grid"></div>

<script>
let productos = [];
let filtroCalidad = "ALL";
const WHATSAPP = "51994275618";

fetch("data/catalogo.csv")
.then(res => res.text())
.then(text => {
  productos = parseCSV(text);
  render();
});

function parseCSV(text){
  const lines = text.trim().split("\n");
  const headers = lines.shift().split(";");
  return lines.map(line=>{
    const values = line.split(";");
    let obj = {};
    headers.forEach((h,i)=> obj[h.trim()] = values[i]?.trim() || "");
    return obj;
  });
}

function setQuality(q){
  filtroCalidad = q;
  render();
}

function render(){
  const cont = document.getElementById("catalogo");
  cont.innerHTML = "";

  productos
  .filter(p => filtroCalidad==="ALL" || p.calidad===filtroCalidad)
  .forEach(p => {

    const tallas = p.tallas ? p.tallas.split(",") : [];

    const card = document.createElement("div");
    card.className = "card";

    const img = document.createElement("img");
    img.src = "img/" + p.imagen;
    img.onerror = () => img.style.display="none";

    const select = document.createElement("select");
    select.innerHTML = `<option value="">Selecciona talla</option>`;
    tallas.forEach(t=>{
      const opt = document.createElement("option");
      opt.value = t;
      opt.textContent = t;
      select.appendChild(opt);
    });

    const btn = document.createElement("button");
    btn.className = "buy";
    btn.textContent = "Comprar por WhatsApp";
    btn.onclick = ()=>{
      if(!select.value){
        alert("Selecciona una talla");
        return;
      }
      const msg =
`Hola, quiero comprar:
Modelo: ${p.nombre}
Precio: S/.${p.precio}
Calidad: ${p.calidad}
Talla: ${select.value}`;
      window.open(`https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`);
    };

    card.appendChild(img);
    card.innerHTML += `
      <h3>${p.nombre}</h3>
      <p>Precio: S/.${p.precio}</p>
      <p>Calidad: ${p.calidad}</p>
    `;
    card.appendChild(select);
    card.appendChild(btn);

    cont.appendChild(card);
  });
}
</script>

</body>
</html>
