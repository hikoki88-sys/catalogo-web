<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Catálogo Mayorista</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial, sans-serif;
  background:#fff;
  margin:0;
  padding:20px;
}
h1{text-align:center}
.filters{text-align:center;margin-bottom:20px}
.filters button{
  padding:8px 14px;
  margin:4px;
  border:1px solid #000;
  background:#fff;
  cursor:pointer;
}
.filters button.active{
  background:#000;
  color:#fff;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
  gap:20px;
}
.card{
  border:1px solid #ddd;
  padding:12px;
}
.card img{
  width:100%;
  height:180px;
  object-fit:cover;
  background:#f3f3f3;
}
.card h3{margin:8px 0;font-size:16px}
.card p{margin:4px 0;font-size:14px}
select,button.buy{
  width:100%;
  padding:8px;
  margin-top:6px;
}
button.buy{
  background:#000;
  color:#fff;
  border:none;
  cursor:pointer;
}
</style>
</head>

<body>

<h1>Catálogo Mayorista</h1>

<div class="filters">
  <button onclick="setQuality('ALL')" class="active">Todos</button>
  <button onclick="setQuality('PK')">PK</button>
  <button onclick="setQuality('LJR')">LJR</button>
</div>

<div id="grid" class="grid"></div>

<script>
const CSV_PATH = "data/catalogo.csv";
const WHATSAPP = "51994275618";

let products = [];
let currentQuality = "ALL";

fetch(CSV_PATH)
  .then(res => res.text())
  .then(text => {
    products = parseCSV(text);
    render();
  });

function parseCSV(text){
  const lines = text.trim().split("\n");
  const headers = lines.shift().split(";");
  return lines.map(line=>{
    const values = line.split(";");
    const obj = {};
    headers.forEach((h,i)=>obj[h]=values[i]||"");
    obj.tallas = obj.tallas ? obj.tallas.split(",") : [];
    return obj;
  });
}

function setQuality(q){
  currentQuality = q;
  document.querySelectorAll(".filters button").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
  render();
}

function render(){
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  products
    .filter(p => currentQuality==="ALL" || p.calidad===currentQuality)
    .forEach(p=>{
      const card = document.createElement("div");
      card.className="card";

      const imgSrc = p.imagen ? `img/${p.imagen}` : "";

      card.innerHTML = `
        <img src="${imgSrc}" onerror="this.style.display='none'">
        <h3>${p.nombre}</h3>
        <p>Precio: S/. ${p.precio}</p>
        <p>Calidad: ${p.calidad}</p>
        <select>
          <option value="">Selecciona talla</option>
          ${p.tallas.map(t=>`<option value="${t}">${t}</option>`).join("")}
        </select>
        <button class="buy">Comprar por WhatsApp</button>
      `;

      card.querySelector(".buy").onclick = ()=>{
        const talla = card.querySelector("select").value;
        if(!talla){ alert("Selecciona una talla"); return; }

        const msg = `Hola, quiero comprar:
Modelo: ${p.nombre}
Calidad: ${p.calidad}
Precio: S/. ${p.precio}
Talla: ${talla}`;

        window.open(`https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`);
      };

      grid.appendChild(card);
    });
}
</script>

</body>
</html>
