<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Catálogo Mayorista</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    font-family: Arial, sans-serif;
    background:#fff;
    margin:0;
    padding:20px;
}
h1{
    text-align:center;
}
input{
    width:100%;
    padding:12px;
    margin:20px 0;
    font-size:16px;
}
#categories{
    margin-bottom:20px;
}
button{
    padding:8px 14px;
    margin:5px;
    border:none;
    background:#000;
    color:#fff;
    cursor:pointer;
}
#products{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
    gap:20px;
}
.card{
    border:1px solid #ddd;
    padding:15px;
}
.card img{
    width:100%;
    height:220px;
    object-fit:contain;
    background:#f5f5f5;
}
.price{
    font-weight:bold;
}
</style>
</head>

<body>

<h1>Catálogo Mayorista</h1>
<p style="text-align:center;">Selecciona tu modelo y compra por WhatsApp</p>

<input type="text" id="search" placeholder="Buscar modelo...">

<div id="categories"></div>

<div id="products"></div>

<script>
const CSV_PATH = "data/catalogo.csv";
const IMG_PATH = "img/";
const WHATSAPP_NUMBER = "51999999999"; // ← cambia por tu número

let products = [];
let currentCategory = "todos";

// ---------- CARGAR CSV ----------
fetch(CSV_PATH)
.then(r => r.text())
.then(text => {
    products = parseCSV(text);
    renderCategories();
    renderProducts();
});

// ---------- PARSE CSV ----------
function parseCSV(text){
    const lines = text.trim().split("\n");
    const headers = lines.shift().split(";");

    return lines.map(line => {
        const values = line.split(";");
        let obj = {};
        headers.forEach((h,i)=>{
            obj[h.trim()] = values[i] ? values[i].trim() : "";
        });
        return obj;
    });
}

// ---------- CATEGORÍAS ----------
function renderCategories(){
    const cats = ["todos", ...new Set(products.map(p => p.categoria.toLowerCase()))];
    const cont = document.getElementById("categories");
    cont.innerHTML = "";

    cats.forEach(cat=>{
        const btn = document.createElement("button");
        btn.textContent = cat.toUpperCase();
        btn.onclick = () => {
            currentCategory = cat;
            renderProducts();
        };
        cont.appendChild(btn);
    });
}

// ---------- PRODUCTOS ----------
function renderProducts(){
    const cont = document.getElementById("products");
    const search = document.getElementById("search").value.toLowerCase();
    cont.innerHTML = "";

    products
    .filter(p => currentCategory === "todos" || p.categoria.toLowerCase() === currentCategory)
    .filter(p => p.nombre.toLowerCase().includes(search))
    .forEach(p=>{
        const card = document.createElement("div");
        card.className = "card";

        const img = p.imagen 
            ? `<img src="${IMG_PATH + p.imagen}" alt="${p.nombre}" onerror="this.style.display='none'">`
            : "";

        card.innerHTML = `
            ${img}
            <h3>${p.nombre}</h3>
            <p class="price">S/. ${p.precio}</p>
            <p>Calidad: ${p.calidad}</p>
            <p>Tallas: ${p.tallas}</p>
            <button onclick="buy('${p.nombre}','${p.precio}','${p.tallas}')">Comprar</button>
        `;
        cont.appendChild(card);
    });
}

// ---------- WHATSAPP ----------
function buy(nombre,precio,tallas){
    const msg = `Hola, quiero comprar:\nModelo: ${nombre}\nPrecio: S/. ${precio}\nTallas disponibles: ${tallas}`;
    window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`);
}

document.getElementById("search").addEventListener("input", renderProducts);
</script>

</body>
</html>
